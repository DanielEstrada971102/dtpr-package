

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>NTuple &mdash; dtpr-package 0.1.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../../_static/general_styles.css" />

  
      <script src="../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../_static/documentation_options.js?v=01f34227"></script>
      <script src="../../_static/doctools.js?v=9bcbadda"></script>
      <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="particles" href="../particles/main.html" />
    <link rel="prev" title="Event" href="event.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            dtpr-package
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="main.html">base</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="event.html">Event</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">NTuple</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../particles/main.html">particles</a></li>
<li class="toctree-l1"><a class="reference internal" href="../geometry/main.html">geometry</a></li>
<li class="toctree-l1"><a class="reference internal" href="../patches/main.html">patches</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">dtpr-package</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="main.html">base</a></li>
      <li class="breadcrumb-item active">NTuple</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/src/base/ntuple.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="ntuple">
<h1>NTuple<a class="headerlink" href="#ntuple" title="Link to this heading"></a></h1>
<p>The <code class="docutils literal notranslate"><span class="pre">NTuple</span></code> class serves as a simple gateway to access information from single or multiple root
Ntuples located in the specified input path. It provides an interface to build <code class="docutils literal notranslate"><span class="pre">Event</span></code> instances
directly from the root event entries. This class is capable of filtering and building <code class="docutils literal notranslate"><span class="pre">Event</span></code>
instances according to the <strong>selectors</strong> passed.</p>
<p>A selector should be a function that returns a boolean based on the information of an <code class="docutils literal notranslate"><span class="pre">Event</span></code> instance.
For instance, follow function will be pass all events:</p>
<p>The <code class="docutils literal notranslate"><span class="pre">NTuple</span></code> class is designed to be generic and handle any type of root NTuple. It is intended to
be used as a parent class. In practice, you should create a child class that inherits from <code class="docutils literal notranslate"><span class="pre">NTuple</span></code>
and implement the <code class="docutils literal notranslate"><span class="pre">run</span></code> method to perform any necessary preprocessing steps before creating and
selecting <code class="docutils literal notranslate"><span class="pre">Event</span></code> instances.</p>
<p>You can generate a skeleton of a child class using the dtpr command as follows:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>dtpr<span class="w"> </span>create<span class="w"> </span>ntuple<span class="w"> </span>--name<span class="w"> </span>DtNtuple<span class="w"> </span>-o<span class="w"> </span><span class="o">[</span>output_folder<span class="o">]</span>
</pre></div>
</div>
<p>This will create a new file called <code class="docutils literal notranslate"><span class="pre">dt_ntuple.py</span></code> in the specified output folder with the following content:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">dtpr.base.event</span><span class="w"> </span><span class="kn">import</span> <span class="n">Event</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">dtpr.base.ntuple</span><span class="w"> </span><span class="kn">import</span> <span class="n">NTuple</span>

<span class="k">class</span><span class="w"> </span><span class="nc">DtNtuple</span><span class="p">(</span><span class="n">NTuple</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inputFolder</span><span class="p">,</span> <span class="n">selectors</span><span class="p">,</span> <span class="n">maxfiles</span><span class="o">=-</span><span class="mi">1</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialize a DtNtuple instance.</span>

<span class="sd">        :param inputFolder: The folder containing the input files.</span>
<span class="sd">        :type inputFolder: str</span>
<span class="sd">        :param selectors: A list of selector functions to apply to the events. See dtpr.utils.filters</span>
<span class="sd">        :type selectors: list</span>
<span class="sd">        :param maxfiles: The maximum number of files to process. Defaults to -1 (process all files).</span>
<span class="sd">        :type maxfiles: int, optional</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">inputFolder</span><span class="p">,</span> <span class="n">selectors</span><span class="p">,</span> <span class="n">maxfiles</span><span class="p">)</span> <span class="c1"># add tree_name argument if needed, default is &quot;/TTREE&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ev</span><span class="p">:</span> <span class="n">Event</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Run the event analysis specific to DtNtuple.</span>

<span class="sd">        :param ev: The event to analyze.</span>
<span class="sd">        :type ev: Event</span>
<span class="sd">        :returns: The analyzed event if it passes the selection criteria, otherwise None.</span>
<span class="sd">        :rtype: Event</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Implement specific analysis here before applying global selection</span>
        <span class="c1"># ...</span>

        <span class="c1"># Apply global selection</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">passes_event</span><span class="p">(</span><span class="n">ev</span><span class="p">):</span>
            <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ev</span>
</pre></div>
</div>
<p>and then, you can implement the specific analysis for your NTuple (from the previous skeleton,
the tree_name argument was set to <cite>/dtNtupleProducer/DTTREE`</cite> to agree with the inputs).</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">dtpr.base.event</span><span class="w"> </span><span class="kn">import</span> <span class="n">Event</span>

<span class="k">def</span><span class="w"> </span><span class="nf">example_selector</span><span class="p">(</span><span class="n">event</span><span class="p">:</span> <span class="n">Event</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
    <span class="c1"># Example selector function that always returns True</span>
    <span class="k">return</span> <span class="kc">True</span>

<span class="n">input_folder</span> <span class="o">=</span> <span class="s2">&quot;DTDPGNtuple_12_4_2_Phase2Concentrator_Simulation_101.root&quot;</span>
<span class="n">selectors</span> <span class="o">=</span> <span class="p">[</span><span class="n">example_selector</span><span class="p">]</span>

<span class="n">dt_ntuple</span> <span class="o">=</span> <span class="n">DtNtuple</span><span class="p">(</span><span class="n">input_folder</span><span class="p">,</span> <span class="n">selectors</span><span class="p">)</span>
<span class="c1"># you can iterate over the events built as Event instances</span>
<span class="n">event</span> <span class="o">=</span> <span class="nb">iter</span><span class="p">(</span><span class="n">dt_ntuple</span><span class="o">.</span><span class="n">events</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">next</span><span class="p">(</span><span class="n">event</span><span class="p">))</span>

<span class="c1"># or simply use the root tree which is a ROOT.TChain</span>
<span class="k">for</span> <span class="n">ev</span> <span class="ow">in</span> <span class="n">dt_ntuple</span><span class="o">.</span><span class="n">tree</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Driectly from ROOT.TChain&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">ev</span><span class="o">.</span><span class="n">gen_pt</span><span class="p">)</span>
    <span class="k">break</span>
</pre></div>
</div>
<p class="rubric">Output</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>+ Opening input file DTDPGNtuple_12_4_2_Phase2Concentrator_Simulation_101.root
&gt;&gt; ------ Event 0 info ------
+ Digis
    * Number of digis: 95
+ Segments
    * Number of segments: 8
    * (iSeg, Phi, eta): [&#39;(0.00, 0.65, -1.03)&#39;, &#39;(1.00, -0.82, -1.02)&#39;, &#39;(2.00, 0.93, 0.67)&#39;, &#39;(3.00, -3.07, -0.00)&#39;, &#39;(4.00, -2.78, -0.40)&#39;]
+ Tps
    * Number of tps: 15
+ Genmuons
    * Number of genmuons: 1
    * Muon 0
    --&gt; GenPart Idx: 0
    --&gt; pT: 1953.97 GeV
    --&gt; Eta: 1.39
    --&gt; Phi: 0.35
    --&gt; Matched segments indices: []
    --&gt; Matched segments location: []
    --&gt; Stations traversed: []
    --&gt; Not showered
+ Emushowers
    * Number of emushowers: 0
{ 1953.97f, 1947.34f }
</pre></div>
</div>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>NTuple.events is a generator that yields Event instances. You can iterate over it to access the
events but you can’t access the events by index. If you need to access the events by index, you
can convert the generator to a list but be aware that this will load all the events into memory.</p>
</div>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="event.html" class="btn btn-neutral float-left" title="Event" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../particles/main.html" class="btn btn-neutral float-right" title="particles" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, Daniel Estrada.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>