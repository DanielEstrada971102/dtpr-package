

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>NTuple &mdash; dtpr-package 0.1.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../../_static/general_styles.css" />

  
      <script src="../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../_static/documentation_options.js?v=01f34227"></script>
      <script src="../../_static/doctools.js?v=9bcbadda"></script>
      <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="EventList" href="event_list.html" />
    <link rel="prev" title="Event" href="event.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            dtpr-package
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="main.html">base</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="event.html">Event</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">NTuple</a></li>
<li class="toctree-l2"><a class="reference internal" href="event_list.html">EventList</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../particles/main.html">particles</a></li>
<li class="toctree-l1"><a class="reference internal" href="../geometry/main.html">geometry</a></li>
<li class="toctree-l1"><a class="reference internal" href="../patches/main.html">patches</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">dtpr-package</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="main.html">base</a></li>
      <li class="breadcrumb-item active">NTuple</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/src/base/ntuple.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="ntuple">
<h1>NTuple<a class="headerlink" href="#ntuple" title="Link to this heading">ÔÉÅ</a></h1>
<p>The <code class="docutils literal notranslate"><span class="pre">NTuple</span></code> class serves as a simple gateway to access information from single or multiple <cite>.root</cite>
Ntuples (flat) located in the specified input path. It represents an interface to build <code class="docutils literal notranslate"><span class="pre">Event</span></code> instances
directly from the root event entries. This class is capable of filtering and building <code class="docutils literal notranslate"><span class="pre">Event</span></code>
instances according to the <strong>selectors</strong> passed.</p>
<p>A selector should be a function that returns a boolean based on the information of an <code class="docutils literal notranslate"><span class="pre">Event</span></code> instance.
For instance, follow function will be pass all events:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">example_selector</span><span class="p">(</span><span class="n">event</span><span class="p">):</span>
    <span class="c1"># Example selector function that always returns True</span>
    <span class="k">return</span> <span class="kc">True</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">NTuple</span></code> class is designed to be generic and handle any type of root flat NTuple. It is intended to
be used as a parent class. In practice, you should create a child class that inherits from <code class="docutils literal notranslate"><span class="pre">NTuple</span></code>
and implement the <code class="docutils literal notranslate"><span class="pre">event_preprocessor</span></code> method to perform any necessary preprocessing steps before creating and
selecting <code class="docutils literal notranslate"><span class="pre">Event</span></code> instances. This was implemented in that way to allow create selector based on properties that by default
does not come direclty from the root input, but cab be computed with extra funcions steps before apply the selection.</p>
<p>You can generate a skeleton of a child class using the dtpr command as follows:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>dtpr<span class="w"> </span>create<span class="w"> </span>ntuple<span class="w"> </span>--name<span class="w"> </span>DtNtuple<span class="w"> </span>-o<span class="w"> </span><span class="o">[</span>output_folder<span class="o">]</span>
</pre></div>
</div>
<p>This will create a new file called <code class="docutils literal notranslate"><span class="pre">dt_ntuple.py</span></code> in the specified output folder with the following content:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">dtpr.base</span><span class="w"> </span><span class="kn">import</span> <span class="n">Event</span><span class="p">,</span> <span class="n">NTuple</span>

<span class="k">class</span><span class="w"> </span><span class="nc">DtNtuple</span><span class="p">(</span><span class="n">NTuple</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inputFolder</span><span class="p">,</span> <span class="n">selectors</span><span class="p">,</span> <span class="n">maxfiles</span><span class="o">=-</span><span class="mi">1</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialize a DtNtuple instance.</span>

<span class="sd">        :param inputFolder: The folder containing the input files.</span>
<span class="sd">        :type inputFolder: str</span>
<span class="sd">        :param selectors: A list of selector functions to apply to the events. See dtpr.utils.filters</span>
<span class="sd">        :type selectors: list</span>
<span class="sd">        :param maxfiles: The maximum number of files to process. Defaults to -1 (process all files).</span>
<span class="sd">        :type maxfiles: int, optional</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">inputFolder</span><span class="p">,</span> <span class="n">selectors</span><span class="p">,</span> <span class="n">maxfiles</span><span class="p">)</span> <span class="c1"># add tree_name argument if needed, default is &quot;/TTREE&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">event_preprocessor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ev</span><span class="p">:</span> <span class="n">Event</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Preprocess the event. Specific to DtNtuple.</span>

<span class="sd">        :param ev: The event to preprocess.</span>
<span class="sd">        :type ev: Event</span>
<span class="sd">        :returns: The preprocessed event if it passes the selection criteria, otherwise None.</span>
<span class="sd">        :rtype: Event</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Implement specific analysis here before apply global selection</span>
        <span class="c1"># ...</span>

        <span class="c1"># Apply global selection</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">select_event</span><span class="p">(</span><span class="n">ev</span><span class="p">):</span>
            <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ev</span>
</pre></div>
</div>
<p>and then, you can implement the specific analysis for your NTuple as follow.</p>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>In the exemple below, the tree_name argument in the <code class="docutils literal notranslate"><span class="pre">super.__init__</span></code> call was set to <code class="docutils literal notranslate"><span class="pre">/dtNtupleProducer/DTTREE</span></code> to agree with the inputs used</p>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">dt_ntuple</span><span class="w"> </span><span class="kn">import</span> <span class="n">DtNtuple</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Example of how to use the DtNtuple class to read DT Ntuples and analyze events.</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="k">def</span><span class="w"> </span><span class="nf">example_selector</span><span class="p">(</span><span class="n">event</span><span class="p">):</span>
    <span class="c1"># Example selector function that always returns True</span>
    <span class="k">return</span> <span class="kc">True</span>

<span class="n">input_folder</span> <span class="o">=</span> <span class="s2">&quot;./DTDPGNtuple_12_4_2_Phase2Concentrator_Simulation_99.root&quot;</span>
<span class="n">selectors</span> <span class="o">=</span> <span class="p">[</span><span class="n">example_selector</span><span class="p">]</span>

<span class="n">dt_ntuple</span> <span class="o">=</span> <span class="n">DtNtuple</span><span class="p">(</span><span class="n">input_folder</span><span class="p">,</span> <span class="n">selectors</span><span class="p">)</span>
<span class="c1"># you can access events by index or slice such as a list</span>
<span class="nb">print</span><span class="p">(</span><span class="n">dt_ntuple</span><span class="o">.</span><span class="n">events</span><span class="p">[</span><span class="mi">10</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="n">dt_ntuple</span><span class="o">.</span><span class="n">events</span><span class="p">[</span><span class="mi">3</span><span class="p">:</span><span class="mi">5</span><span class="p">])</span>

<span class="c1"># or loop over the events</span>
<span class="k">for</span> <span class="n">iev</span><span class="p">,</span> <span class="n">ev</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">dt_ntuple</span><span class="o">.</span><span class="n">events</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">ev</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">iev</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span> <span class="k">break</span>

<span class="c1"># or simply use the root tree, which is a ROOT.TChain</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">ev</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">dt_ntuple</span><span class="o">.</span><span class="n">tree</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">ev</span><span class="o">.</span><span class="n">event_orbitNumber</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> <span class="k">break</span>
</pre></div>
</div>
<p class="rubric">Output</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>+ Opening input file /mnt_pool/c3_users/user/destrada/Public/DTPatternRecognition/src/ntuples/DTDPGNtuple_12_4_2_Phase2Concentrator_Simulation_99.root
&gt;&gt; ------ Event 10 info ------
+ Digis
    * Number of digis: 127
+ Segments
    * Number of segments: 11
    * (iSeg, Phi, eta): [&#39;(0.00, 1.70, -1.14)&#39;, &#39;(1.00, 2.39, -1.01)&#39;, &#39;(2.00, 2.39, -1.00)&#39;, &#39;(3.00, -2.00, -0.35)&#39;, &#39;(4.00, -1.08, 0.92)&#39;]
+ Tps
    * Number of tps: 27
+ Genmuons
    * Number of genmuons: 1
    * Muon 0
    --&gt; GenPart Idx: 0
    --&gt; pT: 656.94 GeV
    --&gt; Eta: -0.97
    --&gt; Phi: -1.23
    --&gt; Matched segments indices: [8]
    --&gt; Matched segments location: [(2, 11, -2)]
    --&gt; Stations traversed: [(2, 11, -2)]
    --&gt; Showered
+ Emushowers
    * Number of emushowers: 1
+ Simhits
    * Number of simhits: 140
[&lt;dtpr.base.event.Event object at 0x7fc6f4ecfb20&gt;, &lt;dtpr.base.event.Event object at 0x7fc6f4ce4b80&gt;]
&gt;&gt; ------ Event 0 info ------
+ Digis
    * Number of digis: 340
+ Segments
    * Number of segments: 28
    * (iSeg, Phi, eta): [&#39;(0.00, 0.09, -1.15)&#39;, &#39;(1.00, 0.31, 0.99)&#39;, &#39;(2.00, 0.31, 0.99)&#39;, &#39;(3.00, 0.77, -1.02)&#39;, &#39;(4.00, 1.30, 0.57)&#39;]
+ Tps
    * Number of tps: 71
+ Genmuons
    * Number of genmuons: 1
    * Muon 0
    --&gt; GenPart Idx: 0
    --&gt; pT: 1601.72 GeV
    --&gt; Eta: 1.00
    --&gt; Phi: 0.31
    --&gt; Matched segments indices: [1, 2, 21, 22]
    --&gt; Matched segments location: [(1, 1, 2), (1, 1, 2), (2, 2, 2), (2, 2, 2)]
    --&gt; Stations traversed: [(1, 1, 2), (1, 1, 2), (2, 2, 2), (2, 2, 2)]
    --&gt; Showered
+ Emushowers
    * Number of emushowers: 2
+ Simhits
    * Number of simhits: 1031
event orbit number:  -1
</pre></div>
</div>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>The <code class="docutils literal notranslate"><span class="pre">NTuple.events</span></code> attribute is not a simple list, but an instance of the <a class="reference internal" href="event_list.html"><span class="doc">EventList</span></a> class.
This design prevents loading all events into memory simultaneously. Instead, it allows iteration and access by index and slice,
while internally iterating over the root tree entries to create the required event on the fly.</p>
</div>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="event.html" class="btn btn-neutral float-left" title="Event" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="event_list.html" class="btn btn-neutral float-right" title="EventList" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, Daniel Estrada.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>